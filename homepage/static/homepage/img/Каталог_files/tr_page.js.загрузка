!function(t,e,n){"use strict";var r=function(){},i={slice:function(t,e,n){return Array.prototype.slice.call(t,e,n)},toNum:function(t){return+t||0},isFunc:function(t){return"function"==typeof t},hasText:function(t){return!!t&&/[a-zA-Z\u00c0-\uffef]/.test(t)},isFrame:function(t){return t&&this.frameTags[t.nodeName]},RTLLangs:{ar:!0,fa:!0,he:!0,ur:!0,yi:!0},debounce:function(e,n){var r;return n=n||100,function(){var i=this,s=arguments;return t.clearTimeout(r),r=t.setTimeout(function(){e.apply(i,s)},n),this}},bindFunc:function(t,e){return function(){return t.apply(e,arguments)}},setZeroDelayTimeout:function(e){t.setTimeout(e,0)},inherits:function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},getStyle:function(e){return t.getComputedStyle(e,null)||e.style},isInline:function(t){var e=this.getStyle(t);return"inline"===e.display&&"static"===e.position},isInvisible:function(t){var e=t.getBoundingClientRect();return e.right<0||e.bottom<0||e.top>this.viewportHeight||e.left>this.viewportWidth},frameTags:{FRAME:!0,IFRAME:!0},breakText:function(t,e){for(var n,r=[];t;)n=this.truncateText(t,e),r.push(n),t=t.slice(n.length);return r},escapeHTML:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},sendRequest:function(e){var n,i,s,o,a,h,u;return e=e||{},i=e.url||"/",s=e.body||null,a=e.params||"",o=e.method||"GET",h=e.timeout||5e3,u=e.callback||r,n=new t.XMLHttpRequest,n.onload=n.onerror=n.ontimeout=function(t){this.response?u(null,this.response):u(new Error(t.type))},a&&(i+=i.indexOf("?")<0?"?":"&",i+=this.toQueryString(a)),n.open(o,i),n.timeout=h,n.responseType="json",s&&(s=this.toQueryString(s),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),n.send(s),n},getDirection:function(t){return this.RTLLangs[t]?"rtl":"ltr"},unescapeHTML:function(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},truncateText:function(t,e){var n,r,i=0;if(t.length<=e)return t;for(r=t.slice(0,e);n=this.truncationRules[i++];)if(n.test(r)){t=r.split(n).slice(0,-1).join("");break}return t},viewportWidth:t.innerWidth,viewportHeight:t.innerHeight,truncationRules:[/(\n+)/,/([.!?;](?:\s+|$))/,/([\-\u2012-\u2015](?:\s+|$))/,/([,:](?:\s+|$))/,/([\u3002\uff01\uff1f\uff1b\u2026])/,/([\uff0c\uff1a])/,/(\s+)/],isButtonInput:function(t){return t&&"INPUT"===t.nodeName&&this.buttonInputTypes[t.type]},toQueryString:function(e){var n,r,i,s,o=[];if(!e)return"";for(i in e)for(s=e[i],Array.isArray(s)||(s=[s]),i=t.encodeURIComponent(i),n=0,r=s.length;n<r;n++)o.push(null==s[n]?i:i+"="+t.encodeURIComponent(s[n]));return o.join("&")},getBrowserLang:function(){return(t.navigator.language||t.navigator.userLanguage||"").split("-")[0]},createPlainObj:function(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){e[n]=t[n]}),e},normalizeValue:function(t){return t.replace(/[ \t\u00a0\u2000-\u200a\u3000]+/g," ")},buttonInputTypes:{reset:!0,submit:!0,button:!0},sendScriptRequest:function(t){return t=t||{},new p(t.url,t).send(t.params,t.callback)}};t.addEventListener("resize",i.debounce(function(){i.viewportWidth=t.innerWidth,i.viewportHeight=t.innerHeight}));var s=function(){this._handlers=i.createPlainObj()};s.prototype.on=function(t,e){var n=this._handlers;return t&&i.isFunc(e)?((n[t]=n[t]||[]).push(e),this):this},s.prototype.off=function(t,e){var n,r,s=arguments.length,o=this._handlers[t];if(!o)return s||(this._handlers=i.createPlainObj()),this;if(1===s)return delete this._handlers[t],this;for(n=0,r=o.length;n<r;n++)if(o[n]===e){o.splice(n,1);break}return this},s.prototype.emit=function(t){var e,n,r=i.slice(arguments,1),s=this._handlers[t];if(s)for(e=0,n=(s=i.slice(s)).length;e<n;e++)s[e].apply(this,r);return this};var o=function(t){if(!t)throw new Error("Invalid request URL!");s.call(this),this._url=t,this._data=null,this._headers=i.createPlainObj()};i.inherits(o,s),o.METHOD_GET="GET",o.METHOD_POST="POST",o.DEFAULT_TIMEOUT=5e3,o.HEADER_CONTENT_TYPE="Content-Type",o.CONTENT_TYPE_JSON="application/json",o.RESPONSE_TYPE_JSON="json",o.EVENTNAME_LOAD="load",o.EVENTNAME_ERROR="error",o.EVENTNAME_TIMEOUT="timeout",o.EVENTNAME_RESPONSE="response",o.prototype.send=function(){var t,e=o.serializeData(this._data,this.getType()),n=this._request=new XMLHttpRequest;n.addEventListener(o.EVENTNAME_LOAD,this,!1),n.addEventListener(o.EVENTNAME_ERROR,this,!1),n.addEventListener(o.EVENTNAME_TIMEOUT,this,!1),n.open(this._method||o.METHOD_GET,this._buildUri());for(t in this._headers)n.setRequestHeader(t,this._headers[t]);n.timeout=this._timeout||o.DEFAULT_TIMEOUT,n.responseType=o.RESPONSE_TYPE_JSON,n.send(e)},o.prototype.abort=function(){this._request&&this._request.abort(),this.destroy()},o.prototype.destroy=function(){var t=this._request;this.off(),t&&(t.removeEventListener(o.EVENTNAME_LOAD,this,!1),t.removeEventListener(o.EVENTNAME_ERROR,this,!1),t.removeEventListener(o.EVENTNAME_TIMEOUT,this,!1),this._request=null)},o.prototype.getType=function(){return this._headers[o.HEADER_CONTENT_TYPE]},o.prototype.setType=function(t){return this.setHeader(o.HEADER_CONTENT_TYPE,t)},o.prototype.setHeader=function(t,e){return this._headers[t]=e,this},o.prototype.setData=function(t){return this._data=t,this},o.prototype.setMethod=function(t){return this._method=t,this},o.prototype.setParams=function(t){return this._params=i.createPlainObj(t),this},o.prototype.setTimeout=function(t){return this._timeout=i.toNum(t),this},o.prototype.handleEvent=function(t){var e,n,r=t.target;r.response?(e=r.response,n=o.EVENTNAME_RESPONSE):(e=new Error(t.type),n=o.EVENTNAME_ERROR),this.emit(n,e).destroy()},o.prototype._buildUri=function(){var t=this._url,e=this._params;return e&&(t+=t.indexOf("?")<0?"?":"&",t+=i.toQueryString(e)),t},o.serializeData=function(t,e){switch(e){case o.CONTENT_TYPE_JSON:return JSON.stringify(t);default:return t}};var a=function(){this.setParams()};a.prototype.getParam=function(t){return this._params[t]},a.prototype.setParam=function(t,e){this._params[t]=e},a.prototype.setParams=function(t){this._params=i.createPlainObj(t)};var h=function(t,e){a.call(this),this._node=t,e&&this.setParams(e)};i.inherits(h,a),h.prototype.getNode=function(){return this._node},h.prototype.getValue=function(){return this._node.parentNode?this._node.nodeValue:""},h.prototype.setValue=function(t){this._node.parentNode&&(this._node.nodeValue=t)};var u=function(){h.apply(this,arguments)};i.inherits(u,h),u.PARAM_ATTR="attr",u.prototype.getValue=function(){return this._node.getAttribute(this.getParam(u.PARAM_ATTR))},u.prototype.setValue=function(t){this._node.setAttribute(this.getParam(u.PARAM_ATTR),t)};var l=function t(e,n,r){a.call(this),this._type=e||t.TYPE_TEXT,this._spans=n||[],r&&this.setParams(r)};i.inherits(l,a),l.TYPE_ATTR="attr",l.TYPE_TEXT="text",l.splitSpan=function(t,n){var r,s,o,a=t.getNode(),u=i.breakText(t.getParam("value"),n),c=[];if(1===(s=u.length))return c;for(o=e.createDocumentFragment(),r=0;r<s;r++)o.appendChild(e.createTextNode(u[r])),u[r].length>n||c.push(new l(l.TYPE_TEXT,[new h(o.lastChild,{value:u[r]})]));return a.parentNode.replaceChild(o,a),c},l.breakChunk=function(t,e){var n,r,i,s=0,o=t.getSpans(),a=[],h=new l;for(n=0,r=o.length;n<r;n++)s+(i=o[n].getParam("value").length)>e&&(s&&(s=0,a.push(h),h=new l),i>e)?a=a.concat(this.splitSpan(o[n],e)):(s+=i,h.addSpan(o[n]));return s&&a.push(h),a},l.prototype.getType=function(){return this._type},l.prototype.setType=function(t){this._type=t},l.prototype.addSpan=function(t){this._spans.push(t)},l.prototype.getSpan=function(t){return this._spans[t]},l.prototype.setSpan=function(t,e){this._spans[t]=e},l.prototype.getSpans=function(){return this._spans.slice()},l.prototype.getValue=function(t){var e,n,r=[],i=this.getSpans();for(e=0,n=i.length;e<n;e++)r.push(i[e].getValue());return t?r.join(""):r},l.prototype.setValue=function(t){var e,n,r=this.getSpans();for(e=0,n=r.length;e<n;e++)r[e].setValue(t[e])},l.prototype.getLength=function(){return this._spans.length};var c=function(t){t=t||{},a.call(this),this._filters=t.filters||[],this._element=t.element||e.documentElement,this._highAccuracy=!!t.highAccuracy,this.reset()};i.inherits(c,a),c.ATTRS=i.createPlainObj({alt:!0,abbr:!0,title:!0,label:!0,value:function(t){return i.isButtonInput(t)&&!t.name},content:function(t){var e,n=!1;return"META"===t.nodeName&&(n=(e=t.getAttribute("property")||t.name).indexOf("title")>=0||e.indexOf("description")>=0),n},placeholder:!0,"aria-label":!0}),c.INLINE_TAGS=i.createPlainObj({A:!0,B:!0,I:!0,Q:!0,S:!0,U:!0,BR:!0,EM:!0,RP:!0,RT:!0,TT:!0,BDI:!0,BDO:!0,BIG:!0,DEL:!0,DFN:!0,IMG:!0,INS:!0,KBD:!0,MAP:!0,SUB:!0,SUP:!0,SVG:!0,VAR:!0,WBR:!0,ABBR:!0,CITE:!0,CODE:!0,DATA:!0,MARK:!0,MATH:!0,RUBY:!0,SAMP:!0,SPAN:!0,TIME:!0,AUDIO:!0,INPUT:!0,LABEL:!0,METER:!0,SMALL:!0,BUTTON:!0,SELECT:!0,STRONG:!0,ACRONYM:!0,PICTURE:!0,PROGRESS:!0,TEXTAREA:!0}),c.SERVICE_TAGS=i.createPlainObj({BASE:!0,LINK:!0,META:!0,STYLE:!0,SCRIPT:!0,NOSCRIPT:!0,TEMPLATE:!0}),c.INVALID_TAGS=i.createPlainObj({SVG:!0,MATH:!0,RUBY:!0,AUDIO:!0,EMBED:!0,VIDEO:!0,CANVAS:!0,OBJECT:!0,PROGRESS:!0,TEXTAREA:!0}),c.NOT_TRANSLATABLE_TAGS=i.createPlainObj({KBD:!0,VAR:!0,CODE:!0,SAMP:!0,ADDRESS:!0}),c.isValidNodeName=function(t){return!this.SERVICE_TAGS[t]&&!this.INVALID_TAGS[t]&&!this.NOT_TRANSLATABLE_TAGS[t]},c.isTranslatableElement=function(t){for(;t&&t.nodeType===Node.ELEMENT_NODE;){if(!this.isValidNodeName(t.nodeName))return!1;if(t.hasAttribute("translate"))return"no"!==t.getAttribute("translate");t=t.parentNode}return!0},c.changeElementDirAndAlign=function(e,n,r){t.setTimeout(function(){var t=i.getStyle(e);t.direction!==n&&(e.style.direction=n),t.textAlign!==r&&"center"!==t.textAlign&&(e.style.textAlign=r)},0)},c.prototype.reset=function(){this._chunks=[],this._currentChunk=new l,this._processedElements=[]},c.prototype.update=function(){var t,e,n,r=this._filters,i=this.getChunks();for(this.reset(),this._parseNode(this._element),n=this.getChunks(),t=0,e=r.length;t<e;t++)n=r[t](n,i)||[];this._chunks=n},c.prototype.getDir=function(){var t=this._element;return t.dir||i.getStyle(t).direction},c.prototype.getLang=function(){return this._element.lang.split("-")[0]},c.prototype.setLang=function(t,e){var n,r,s,o=i.getDirection(t),a="ltr"===o?"left":"right",h=this._processedElements;for(n=0,r=h.length;n<r;n++)(s=h[n]).lang&&s.lang!==t&&(s.lang=t),e&&!c.SERVICE_TAGS[s.nodeName]&&c.changeElementDirAndAlign(s,o,a);return this},c.prototype.addChunk=function(t){this._chunks.push(t)},c.prototype.getChunk=function(t){return this._chunks[t]},c.prototype.setChunk=function(t,e){this._chunks[t]=e},c.prototype.getValue=function(t){var e,n,r=[],i=this.getChunks();for(e=0,n=i.length;e<n;e++)r.push(i[e].getValue(t));return t?r.join(""):r},c.prototype.getChunks=function(){return this._chunks.slice()},c.prototype.getLength=function(){return this._chunks.length},c.prototype.getElement=function(){return this._element},c.prototype._parseNode=function(t,e){var n,r,s,o;if(t)switch(t.nodeType){case Node.TEXT_NODE:if(r=t.nodeValue,e||!r.trim())return;return void this._currentChunk.addSpan(new h(t,{value:r}));case Node.ELEMENT_NODE:if(""===(o=t.getAttribute("translate"))&&(o="yes"),(e=c.NOT_TRANSLATABLE_TAGS[t.nodeName]||"no"===o||!!e&&"yes"!==o)||(this._extractAttrs(t),this._processedElements.push(t)),(s=this._highAccuracy?i.isInline(t):c.INLINE_TAGS[t.nodeName])||this._flushChunk(),c.isValidNodeName(t.nodeName)){if(i.isFrame(t))return this._parseFrame(t,e);for(t.shadowRoot&&this._parseNode(t.shadowRoot,e),n=t.firstChild;n;n=n.nextSibling)this._parseNode(n,e);s||this._flushChunk()}return;case Node.DOCUMENT_FRAGMENT_NODE:for(n=t.firstChild;n;n=n.nextSibling)this._parseNode(n,e);return}},c.prototype._parseFrame=function(t,e){var n=t.src;if(!n||0===n.indexOf("about:"))try{this._parseNode(t.contentDocument.body,e)}catch(t){}},c.prototype._flushChunk=function(){var t=this._currentChunk;return t.getLength()>0&&(i.hasText(t.getValue(!0))&&this.addChunk(t),this._currentChunk=new l),this._currentChunk},c.prototype._extractAttrs=function(t){var e,n,r;for(e in c.ATTRS)n=t.getAttribute(e),i.hasText(n)&&(r=c.ATTRS[e],i.isFunc(r)&&!r(t)||this.addChunk(new l(l.TYPE_ATTR,[new u(t,{attr:e,value:n})])));return this};var p=function(t,e){e=e||{},this._src=t,this._timeout=e.timeout||5e3,this._callbackName=e.callbackName||"callback"};p.counter=0,p.generateId=function(){return"_"+(this.counter++).toString(36)},p.STORAGE_KEY="_"+Date.now().toString(36)+"_",p.prototype.send=function(n,s){var o=this._id=p.generateId(),a=this._src,h=this,u=this._script=e.createElement("script");return n=n||{},n[this._callbackName]=[p.STORAGE_KEY,o].join("."),s=s||r,t[p.STORAGE_KEY]=t[p.STORAGE_KEY]||i.createPlainObj(),u.src=a+(a.indexOf("?")<0?"?":"&")+i.toQueryString(n),u.onerror=function(){h._cleanup(),s(new Error("Network error!"))},t[p.STORAGE_KEY][o]=function(t){h._cleanup(!0),s(null,t)},this._timer=t.setTimeout(u.onerror,this._timeout),e.head.appendChild(u),this},p.prototype.abort=function(){return this._cleanup(!1)},p.prototype._cleanup=function(e){var n=this._id,i=this._script;return i?(t.clearTimeout(this._timer),e?delete t[p.STORAGE_KEY][n]:t[p.STORAGE_KEY][n]=r,i.onerror=null,i.parentNode&&i.parentNode.removeChild(i),this._script=null,this):this};var _=function t(e){e=e||{},this._key=e.key,this._srv=e.srv,this._sid=e.sid||t.generateSid(),this._url=e.url||"/",this._format=e.format,this._useXHR=e.useXHR,this._timeout=i.toNum(e.timeout),this._options=i.toNum(e.options),this._requests=i.createPlainObj(),this._detectUrl=e.detectUrl,this._extraParams=i.createPlainObj(e.extraParams),this._requestCounter=0};_.OK=200,_.FORMAT_HTML="html",_.MAX_TEXT_LENGTH=1e4,_.generateSid=function(){var t,e,n=Date.now().toString(16);for(t=0,e=16-n.length;t<e;t++)n+=Math.floor(16*Math.random()).toString(16);return n},_.prototype.abort=function(){var t,e=this._requests;for(t in e)e[t].abort();return this._requests=i.createPlainObj(),this},_.prototype.getSid=function(){return this._sid},_.prototype.setExtraParam=function(t,e){this._extraParams[t]=e},_.prototype.getExtraParam=function(t){return this._extraParams[t]},_.prototype.getParams=function(t,e){var n=i.createPlainObj(this._extraParams);return n.id=[this._sid,this._requestCounter,0].join("-"),this._key&&(n.key=this._key),this._srv&&(n.srv=this._srv),n.text=t,n.lang=e,this._format&&(n.format=this._format),this._options&&(n.options=this._options),n},_.prototype.translate=function(t,e,n){var r,s=this._requests;return!t||t.join("").length>_.MAX_TEXT_LENGTH?n(new Error("Invalid text!")):(r=this.getParams(t,e),s[r.id]=i[this._useXHR?"sendRequest":"sendScriptRequest"]({url:this._url,params:r,timeout:this._timeout,callback:function(t,e){delete s[r.id],e&&e.code!==_.OK&&(t=new Error(e.message),e=null),n(t,e)}}),this._requestCounter+=1,this)},_.prototype.detectLang=function(t,e,n){this._detectRequest&&this._detectRequest.abort(),this._detectRequest=new o(this._detectUrl),this._detectRequest.on(o.EVENTNAME_ERROR,function(t){n(t)}).on(o.EVENTNAME_RESPONSE,function(t){t.code===_.OK?n(null,t):n(new Error(t.message))}).setParams({sid:this._sid,srv:this._srv,text:t,hint:e.join(",")}).setTimeout(this._timeout).send()};var E=function(t){s.call(this),this._target=t,this.handleEvent=i.debounce(this.handleEvent)};i.inherits(E,s),E.prototype.observe=function(){this._target.addEventListener("scroll",this)},E.prototype.hibernate=function(){this._target.removeEventListener("scroll",this)},E.prototype.handleEvent=function(t){this.emit(t.type)};var d=function e(n,r){s.call(this),this._element=n,this._options=r||e.DEFAULT_OPTIONS,this._observer=new t.MutationObserver(i.debounce(i.bindFunc(this._handleData,this)))};i.inherits(d,s),d.canUse=function(){return"MutationObserver"in t},d.TYPE_CHILDLIST="childList",d.TYPE_ATTRIBUTES="attributes",d.TYPE_CHARACTERDATA="characterData",d.DEFAULT_OPTIONS={subtree:!0,childList:!0,attributes:!0,characterData:!0},d.prototype.observe=function(){return this._active=!0,this._observer.observe(this._element,this._options),this},d.prototype.hibernate=function(){return this._active=!1,this._observer.disconnect(),this},d.prototype._handleData=function(t){this._active&&this.emit("modify",t)};var T=function(t,e){s.call(this),this._element=t,this._timeout=e||5e3,this._interval=0,this._checkContent=i.bindFunc(this._checkContent,this)};i.inherits(T,s),T.prototype.observe=function(){return this._interval?this:(this._content=this._element.textContent,this._interval=t.setInterval(this._checkContent,this._timeout),this)},T.prototype.hibernate=function(){return t.clearInterval(this._interval),this._interval=0,this},T.prototype._checkContent=function(){var t=this._element.textContent;this._content!==t&&(this._content=t,this.emit("modify"))};var g=function e(n){var r,o=this,a=[];s.call(this),(n=n||{}).format=_.FORMAT_HTML,a.push(i.bindFunc(this._syncChunks,this)),a.push(i.bindFunc(this._breakChunks,this)),n.checkVisibility&&(a.push(e.markInvisibleChunks),this._scrollObserver=new E(t),this._scrollObserver.on("scroll",i.bindFunc(this.sync,this))),n.filters=a.concat(n.filters||[]),this._alignChunkCounter=0,this._pageModel=new c(n),this._textTranslator=new _(n),this._maxThreads=n.maxThreads||5,this._maxPortionItems=n.maxPortionItems||20,this._maxPortionErrors=n.maxPortionErrors||2,this._maxPortionLength=n.maxPortionLength||1e3,n.autoSync&&(r=this._pageModel.getElement(),d.canUse()?this._modifyObserver=new d(r):this._modifyObserver=new T(r,n.autoSyncInterval),this._modifyObserver.on("modify",function(t){t&&!e.isValidObserverData(t)||o.sync()}))};i.inherits(g,s),g.DELIMITER="<wbr>",g.SPAN_TYPE="trSpan",g.SPAN_TAGNAME="ya-tr-span",g.EVENTNAME_ABORT="abort",g.EVENTNAME_ERROR="error",g.EVENTNAME_DETECT="detect",g.EVENTNAME_COMPLETE="complete",g.EVENTNAME_PROGRESS="progress",g.EVENTNAME_PORTION_ERROR="portionError",g.EVENTNAME_PORTION_PROGRESS="portionProgress",g.wrapSpan=function(t){var n,r=t.getNode(),s=t.getValue(),o=r.parentNode.getAttribute("data-type")===this.SPAN_TYPE,a=t.getParam("value");return(n=o?r.parentNode:e.createElement(this.SPAN_TAGNAME)).setAttribute("data-index",t.getParam("index")),n.setAttribute("data-value",i.normalizeValue(a)),n.setAttribute("data-translation",i.normalizeValue(s)),o||(n.textContent=s,n.setAttribute("data-type",this.SPAN_TYPE),r.parentNode.replaceChild(n,r),r=n.firstChild),o?t:new h(r,{value:a,translated:!0,translation:s})},g.parseAlign=function(t){var e,n,r;if(!t)return[];for(e=0,n=(t=t.split(";")).length;e<n;e++)(r=(r=t[e]).split("-"))[0]=r[0].split(":"),r[1]=r[1].split(":"),r[0][0]=+r[0][0],r[0][1]=+r[0][1]+r[0][0],r[1][0]=+r[1][0],r[1][1]=+r[1][1]+r[1][0],0===e?r[0][0]=r[1][0]=0:(t[e-1][0][1]=r[0][0],t[e-1][1][1]=r[1][0]),t[e]=r;return t},g.prepareValue=function(t){var e,n=t.length;for(e=0;e<n;e++)t[e]=i.escapeHTML(i.normalizeValue(t[e]));return t.join(this.DELIMITER)},g.parseTranslation=function(t){var e,n;for(e=0,n=(t=t.split(this.DELIMITER)).length;e<n;e++)t[e]=i.unescapeHTML(t[e]);return t},g.isChunkInvisible=function(t){return this.isChunkIncludeParam(t,"invisible")},g.isChunkTranslated=function(t){return this.isChunkIncludeParam(t,"translated")},g.isChunkIncludeParam=function(t,e){for(var n=0,r=t.getSpans(),i=r.length;n<i&&r[n].getParam(e);)n++;return n===i},g.isValidObserverData=function(t){var e=[];return t.forEach(function(t){var n=t.target;switch(t.type){case d.TYPE_CHILDLIST:i.slice(t.addedNodes).forEach(function(t){var n,r=t.nodeType;r!==Node.TEXT_NODE&&r!==Node.ELEMENT_NODE||(n=r===Node.TEXT_NODE?t.parentNode:t,c.isTranslatableElement(n)&&e.push(t.textContent))});break;case d.TYPE_ATTRIBUTES:t.attributeName in c.ATTRS&&c.isTranslatableElement(n)&&e.push(n.getAttribute(t.attributeName));break;case d.TYPE_CHARACTERDATA:n.nodeType===Node.TEXT_NODE&&c.isTranslatableElement(n.parentNode)&&e.push(n.data)}}),i.hasText(e.join(""))},g.getChunkValueLength=function(t){var e,n,r=0,i=t.getSpans();for(e=0,n=i.length;e<n;e++)r+=i[e].getParam("value").length;return r},g.getChunkAncestorNode=function(t){var e=t.getSpan(0).getNode();for(e.nodeType!==Node.ELEMENT_NODE&&(e=e.parentNode);e&&e.nodeName in c.INLINE_TAGS;)e=e.parentNode;return e},g.markInvisibleChunks=function(t,e){return t.forEach(function(t){var e,n;g.isChunkTranslated(t)||(e=g.getChunkAncestorNode(t))&&(n=i.isInvisible(e),t.getSpans().forEach(function(t){t.setParam("invisible",n)}))}),t},g.prototype.halt=function(){return this.abort(),this._modifyObserver&&this._modifyObserver.hibernate(),this._scrollObserver&&this._scrollObserver.hibernate(),this},g.prototype.sync=function(){return this.halt(),this.translate(this._sourceLang,this._targetLang),this},g.prototype.undo=function(){var t,e,n,r,s,o,a,h,u=this._pageModel;for(this.halt(),t=0,n=(a=u.getChunks()).length;t<n;t++)for(e=0,r=(o=a[t].getSpans()).length;e<r;e++)(s=o[e]).setParam("translated",!1),s.setValue(s.getParam("value"));return(h=this.getSourceLang())&&u.setLang(h,i.getDirection(h)!==i.getDirection(this._targetLang)),this},g.prototype.redo=function(){var t,e,n,r,i,s,o,a;for(this.halt(),t=0,n=(o=this._pageModel.getChunks()).length;t<n;t++)for(e=0,r=(s=o[t].getSpans()).length;e<r;e++)(a=(i=s[e]).getParam("translation"))&&(i.setValue(a),i.setParam("translated",!0));return this.translate(this._sourceLang,this._targetLang)},g.prototype.abort=function(){return this._textTranslator.abort(),this.emit(g.EVENTNAME_ABORT)},g.prototype.translate=function(t,e){var n,r=this._pageModel,s=i.bindFunc(this._translateNext,this);if(t=t||"",e=e||i.getBrowserLang(),"auto"===t&&(t=""),t===e)return this.emit(g.EVENTNAME_COMPLETE);for(r.update(),this._index=0,this._length=r.getLength(),this._progress=0,this._direction=(t&&t+"-")+e,this._readyThreads=0,this._errorCounter=i.createPlainObj(),this.on(g.EVENTNAME_ABORT,this._handleEnd).on(g.EVENTNAME_COMPLETE,this._handleEnd).on(g.EVENTNAME_PORTION_ERROR,this._handleError).on(g.EVENTNAME_PORTION_PROGRESS,this._handleProgress),this._sourceLang=t,this._targetLang=e,r.setLang(e,r.getDir()!==i.getDirection(e)),this.emit(g.EVENTNAME_PROGRESS,0),n=0;n<this._maxThreads;n++)i.setZeroDelayTimeout(s);return this},g.prototype.applyAlign=function(){var t,n,r,s,o,a,u,c,p,_,E,d,T,f,N,m,y=this._pageModel;for(t=0,r=(d=y.getChunks()).length;t<r;t++)if(d[t].getType()===l.TYPE_TEXT&&(c=g.parseAlign(d[t].getParam("align"))).length){for(o=0,_=N="",E=[0,0],T=[],n=0,s=(p=d[t].getSpans()).length;n<s;n++){for(u=p[n].getNode(),a=e.createDocumentFragment(),_+=p[n].getValue(),N+=i.normalizeValue(p[n].getParam("value"));c[o]&&E[1]<_.length;)f=_.slice(E[1],c[o][1][1]),m=N.slice(E[0],c[o][0][1]),a.appendChild(e.createTextNode(f)),T.push(new h(a.lastChild,{index:this._alignChunkCounter+"-"+o,value:m,translated:!0,translation:f})),E[1]+=f.length,E[0]+=m.length,E[1]===c[o][1][1]&&o++;a.hasChildNodes()&&u.parentNode.replaceChild(a,u)}for(n=0,s=T.length;n<s;n++)T[n]=g.wrapSpan(T[n]);y.setChunk(t,new l(l.TYPE_TEXT,T)),this._alignChunkCounter++}return this},g.prototype.setExtraParam=function(t,e){return this._textTranslator.setExtraParam(t,e),this},g.prototype.getExtraParam=function(t){return this._textTranslator.getExtraParam(t)},g.prototype.getSessionId=function(){return this._textTranslator.getSid()},g.prototype.getSourceLang=function(){var t,e,n,r,s,o,a,h,u;if(this._sourceLang)return this._sourceLang;for(o=i.createPlainObj(),u="",t=0,n=(h=this._pageModel.getChunks()).length;t<n;t++)for(e=0,r=(a=h[t].getSpans()).length;e<r;e++)(s=a[e].getParam("sourceLang"))&&(o[s]=i.toNum(o[s])+1);for(s in o)o[s]>i.toNum(o[u])&&(u=s);return u},g.prototype.getTargetLang=function(){return this._targetLang},g.prototype.detectSourceLang=function(){var t,e,n,r,s=this,o=[];for(this._pageModel.update(),t=0,e=(r=this._pageModel.getChunks()).length;t<e;t++)(n=r[t]).getType()===l.TYPE_TEXT&&o.push(n.getValue(!0));o=o.join(" ").replace(/\s+/g," ").slice(0,this._maxPortionLength),this._textTranslator.detectLang(o,i.slice(arguments),function(t,e){s.emit(g.EVENTNAME_DETECT,e?e.lang:"")})},g.prototype._syncChunks=function(t,e){var n,r,s,o,a,h,u,l,c,p,_=i.createPlainObj();if(!(s=e.length))return t;for(n=0;n<s;n++)for(r=0,o=(l=e[n].getSpans()).length;r<o;r++)(_[c=l[r].getValue()]=_[c]||[]).push(l[r]);for(n=0,s=t.length;n<s;n++)for(r=0,o=(l=t[n].getSpans()).length;r<o;r++)if(u=l[r].getNode(),c=l[r].getValue(),p=_[c])for(a=0,h=p.length;a<h;a++)if(u===p[a].getNode()&&c===p[a].getParam("translation")){t[n].setSpan(r,p[a]);break}return t},g.prototype._breakChunks=function(t){var e,n,r=[];for(e=0,n=t.length;e<n;e++)g.isChunkTranslated(t[e])||g.getChunkValueLength(t[e])<=this._maxPortionLength?r.push(t[e]):t[e].getType()===l.TYPE_TEXT&&(r=r.concat(l.breakChunk(t[e],this._maxPortionLength)));return r},g.prototype._handleEnd=function(){this.off(g.EVENTNAME_ABORT,this._handleEnd).off(g.EVENTNAME_COMPLETE,this._handleEnd).off(g.EVENTNAME_PORTION_ERROR,this._handleError).off(g.EVENTNAME_PORTION_PROGRESS,this._handleProgress)},g.prototype._handleError=function(t){var e="_"+t.join(";");this._errorCounter[e]=i.toNum(this._errorCounter[e])+1,this._errorCounter[e]<=this._maxPortionErrors?this._translatePortion(t):this.emit(g.EVENTNAME_ERROR,t).emit(g.EVENTNAME_PORTION_PROGRESS,t)},g.prototype._handleProgress=function(t){this._progress+=t.length,this.emit(g.EVENTNAME_PROGRESS,Math.round(100/this._length*this._progress)),this._translateNext()},g.prototype._getNextPortion=function(){var t,e,n,r=this._pageModel.getChunks(),i=[],s=0,o=0;for(t=this._index,e=r.length;t<e&&s<this._maxPortionItems;t++)if(n=r[t],g.isChunkInvisible(n)||g.isChunkTranslated(n))this._progress+=1;else{if((o+=g.getChunkValueLength(n))>this._maxPortionLength&&s)break;s=i.push(t)}return this._index=t,i},g.prototype._translateNext=function(){var t=this._getNextPortion();return t.length?(this._translatePortion(t),this):(++this._readyThreads===this._maxThreads&&(this.emit(g.EVENTNAME_COMPLETE),i.setZeroDelayTimeout(i.bindFunc(this._startObserving,this))),this)},g.prototype._startObserving=function(){this._modifyObserver&&this._modifyObserver.observe(),this._scrollObserver&&this._scrollObserver.observe()},g.prototype._translatePortion=function(t){var e,n,r,i,s,o,a,h=this,u=[];for(e=0,r=t.length;e<r;e++)if(o=this._pageModel.getChunk(t[e])){for(a=[],n=0,i=(s=o.getSpans()).length;n<i;n++)a[n]=s[n].getParam("value");u.push(g.prepareValue(a))}return u.length?(this._textTranslator.translate(u,this._direction,function(e,n){if(e)return h.emit(g.EVENTNAME_PORTION_ERROR,t);h._setTranslation(t,n),h.emit(g.EVENTNAME_PORTION_PROGRESS,t)}),this):this.emit(g.EVENTNAME_PORTION_PROGRESS,t)},g.prototype._setTranslation=function(t,e){var n,r,i,s,o,a,h,u,l=e.lang.split("-");for(n=0,i=t.length;n<i;n++)if(h=this._pageModel.getChunk(t[n]))for(a=h.getSpans(),e.align&&h.setParam("align",e.align[n]),u=g.parseTranslation(e.text[n]),r=0,s=a.length;r<s;r++)(o=a[r]).setValue(u[r]),o.setParam("translated",!0),o.setParam("sourceLang",l[0]),o.setParam("translation",u[r]);return this},n.PageTranslator=g,n.Request=o}(window,window.document,window.yt=window.yt||{});